



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.0.2">
    
    
      
        <title>Customizing your infrastructure and director - BBL</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.982221ab.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.224b79ff.css">
      
      
        
        
        <meta name="theme-color" content="">
      
    
    
      <script src="../assets/javascripts/modernizr.1f0bcf2b.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="white" data-md-color-accent="indigo">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#customizing-your-infrastructure-and-director" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="BBL" class="md-header-nav__button md-logo">
          
            <img src="../theme/bosh.svg" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              BBL
            </span>
            <span class="md-header-nav__topic">
              Customizing your infrastructure and director
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href=".." title="BBL" class="md-nav__button md-logo">
      
        <img src="../theme/bosh.svg" width="48" height="48">
      
    </a>
    BBL
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="BOSH Bootloader" class="md-nav__link">
      BOSH Bootloader
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../advanced-configuration/" title="Advanced configuration" class="md-nav__link">
      Advanced configuration
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../cf-lbs/" title="Cloud Foundry Load Balancers" class="md-nav__link">
      Cloud Foundry Load Balancers
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../cleaning-up/" title="Cleaning Up" class="md-nav__link">
      Cleaning Up
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../cloudfoundry/" title="Generic Steps for Cloud Foundry Deployment" class="md-nav__link">
      Generic Steps for Cloud Foundry Deployment
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../concourse/" title="Concourse" class="md-nav__link">
      Concourse
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../credhub/" title="Accessing the BOSH Director CredHub" class="md-nav__link">
      Accessing the BOSH Director CredHub
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Customizing your infrastructure and director
      </label>
    
    <a href="./" title="Customizing your infrastructure and director" class="md-nav__link md-nav__link--active">
      Customizing your infrastructure and director
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#files-and-directories-that-cannot-be-overridden-or-customized" title="Files and directories that cannot be overridden or customized" class="md-nav__link">
    Files and directories that cannot be overridden or customized
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bbl-ops-files" title="bbl-ops-files" class="md-nav__link">
    bbl-ops-files
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bbl-statejson" title="bbl-state.json" class="md-nav__link">
    bbl-state.json
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bosh-deployment" title="bosh-deployment" class="md-nav__link">
    bosh-deployment
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jumpbox-deployment" title="jumpbox-deployment" class="md-nav__link">
    jumpbox-deployment
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#override-scripts" title="Override scripts" class="md-nav__link">
    Override scripts
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#directories-where-the-user-can-add-files" title="Directories where the user can add files" class="md-nav__link">
    Directories where the user can add files
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cloud-config" title="cloud-config" class="md-nav__link">
    cloud-config
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#terraform" title="terraform" class="md-nav__link">
    terraform
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vars" title="vars" class="md-nav__link">
    vars
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../getting-started-aws/" title="Getting Started: AWS" class="md-nav__link">
      Getting Started: AWS
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../getting-started-azure/" title="Getting Started: Microsoft Azure" class="md-nav__link">
      Getting Started: Microsoft Azure
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../getting-started-gcp/" title="Getting Started: GCP" class="md-nav__link">
      Getting Started: GCP
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../getting-started-openstack/" title="Getting Started: OpenStack" class="md-nav__link">
      Getting Started: OpenStack
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../getting-started-vsphere/" title="Getting Started: vSphere" class="md-nav__link">
      Getting Started: vSphere
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../howto-ssh/" title="How To SSH" class="md-nav__link">
      How To SSH
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../howto-target-bosh-director/" title="How To Target The BOSH Director" class="md-nav__link">
      How To Target The BOSH Director
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../known-issues/" title="Known issues" class="md-nav__link">
      Known issues
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../upgrade/" title="Upgrade" class="md-nav__link">
      Upgrade
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-18" type="checkbox" id="nav-18">
    
    <label class="md-nav__link" for="nav-18">
      Architecture
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-18">
        Architecture
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-18-1" type="checkbox" id="nav-18-1">
    
    <label class="md-nav__link" for="nav-18-1">
      Decisions
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-18-1">
        Decisions
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../architecture/decisions/0001-record-architecture-decisions/" title="1. Record architecture decisions" class="md-nav__link">
      1. Record architecture decisions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../architecture/decisions/0002-replace-go-bindata-with-packr2/" title="2. Replace go-bindata with packr2" class="md-nav__link">
      2. Replace go-bindata with packr2
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#files-and-directories-that-cannot-be-overridden-or-customized" title="Files and directories that cannot be overridden or customized" class="md-nav__link">
    Files and directories that cannot be overridden or customized
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bbl-ops-files" title="bbl-ops-files" class="md-nav__link">
    bbl-ops-files
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bbl-statejson" title="bbl-state.json" class="md-nav__link">
    bbl-state.json
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bosh-deployment" title="bosh-deployment" class="md-nav__link">
    bosh-deployment
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jumpbox-deployment" title="jumpbox-deployment" class="md-nav__link">
    jumpbox-deployment
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#override-scripts" title="Override scripts" class="md-nav__link">
    Override scripts
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#directories-where-the-user-can-add-files" title="Directories where the user can add files" class="md-nav__link">
    Directories where the user can add files
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cloud-config" title="cloud-config" class="md-nav__link">
    cloud-config
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#terraform" title="terraform" class="md-nav__link">
    terraform
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vars" title="vars" class="md-nav__link">
    vars
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="customizing-your-infrastructure-and-director">Customizing your infrastructure and director</h1>
<p>Since version 5.2.0, <code>bbl</code> has allowed customizing the infrastructure and director by editing files within the bbl state dir. This is a guide to which files can and can't
be customized.</p>
<p><img alt="annotated list of files and directories within a bbl state dir" src="../theme/bbl-plan-layout.png" /></p>
<h2 id="files-and-directories-that-cannot-be-overridden-or-customized">Files and directories that cannot be overridden or customized</h2>
<p>There are 3 directories and one file in the <code>bbl</code> state directory which should not be modified by the user.</p>
<h3 id="bbl-ops-files"><code>bbl-ops-files</code></h3>
<p>The <code>bbl-ops-files</code> directory contains ops files for <code>bosh-deployment</code> and <code>jumpbox-deployment</code> which are used by <code>bbl</code> but not part of the main <code>bosh-deployment</code> or
<code>jumpbox-deployment</code> repositories.</p>
<h3 id="bbl-statejson"><code>bbl-state.json</code></h3>
<p>The <code>bbl-state.json</code> file is used to keep track of several different aspects of state that aren't captured by the rest of the state dir:
- load balancer type, cert, and key
- most recent output from Terraform (useful when running without <code>--debug</code>; this will be printed when running <code>bbl latest-error</code>)
- BOSH director information, including:
  - username and password
  - address
  - SSL certificate, private key, and CA
- jumpbox URL
- environment name
- IAAS
- <code>bbl</code> version used to create the state</p>
<h3 id="bosh-deployment"><code>bosh-deployment</code></h3>
<p>This is a copy of the <a href="https://github.com/cloudfoundry/bosh-deployment">cloudfoundry/bosh-deployment</a> Git repository. It contains the base BOSH director manifest, as well
as ops files that configure the CPI, add UAA and Credhub to the director, and allow SSH access to the director. The entire repository is provided, not just the files that
<code>bbl</code> uses in its default director <code>create-env</code> script.</p>
<h3 id="jumpbox-deployment"><code>jumpbox-deployment</code></h3>
<p>This is a copy of the <a href="https://github.com/cloudfoundry/jumpbox-deployment">cloudfoundry/jumpbox-deployment</a> Git repository. It contains the base jumpbox manifest, as well
as ops files that configure the CPI. As with the <code>bosh-deployment</code> directory, the entire Git repository is provided, not just the files <code>bbl</code> uses.</p>
<h2 id="override-scripts">Override scripts</h2>
<p>To create and destroy the jumpbox and director deployments, <code>bbl</code> does not shell out directly to the BOSH CLI. Instead, it uses four wrapper scripts, which are emitted into
the root of the state directory as <code>create-jumpbox.sh</code>, <code>create-director.sh</code>, <code>delete-jumpbox.sh</code>, and <code>delete-director.sh</code>. These files will be rewritten when running
<code>bbl plan</code>, so editing them directly is not recommended. However, if a file with the name <code>create-jumpbox-override.sh</code> is present in the root of the state directory,
<code>bbl</code> will run that script <em>instead</em> of <code>create-jumpbox.sh</code> when creating a jumpbox. The same goes for the other counterparts: <code>create-director-override.sh</code>, <code>delete-
jumpbox-override.sh</code>, and <code>delete-director-override.sh</code>.</p>
<h2 id="directories-where-the-user-can-add-files">Directories where the user can add files</h2>
<h3 id="cloud-config"><code>cloud-config</code></h3>
<p>Any ops file with a name of the form <code>*.yml</code> that is added to the <code>cloud-config</code> directory will be used as an ops file argument by <code>bbl</code> when it runs <code>update-cloud-config</code>.
The ops files will be applied in alphabetical order.</p>
<p>Modifying the <code>cloud-config.yml</code> and <code>ops.yml</code> files directly is not recommended if you can avoid it, as these files will be rewritten on <code>bbl plan</code>, while other files in
the directory will be preserved even if you re-run <code>bbl plan</code>.</p>
<h3 id="terraform"><code>terraform</code></h3>
<p>Adding an HCL file with a <code>*.tf</code> filename to the <code>terraform</code> directory will effectively <em>append</em> that file to the <code>bbl</code> terraform template. Adding an HCL file with a
<code>*_override.tf</code> filename will <em>merge</em> that file with the <code>bbl</code> terraform template when <code>bbl</code> runs <code>terraform apply</code> or <code>terraform destroy</code>. If you are modifying any <code>bbl</code>-
provided Terraform resources using a custom Terraform file, we recommend that you end your filename in <code>_override.tf</code> in order for Terraform to properly process those
modifications.</p>
<p>Changes to the <code>bbl.tf</code> file will be lost on re-running <code>bbl plan</code>, but all other files in the directory will not be modified.</p>
<h3 id="vars"><code>vars</code></h3>
<p>Adding a file with a <code>*.tfvars</code> filename to the <code>vars</code> directory will allow custom variables to be picked up by Terraform when <code>bbl</code> runs <code>terraform apply</code>. The general
format of a <code>tfvars</code> file is <code>key="value"</code>. Values longer than one line can be provided using heredoc syntax, for instance:</p>
<pre><code>aws_iam_access_policy = &lt;&lt;EOF
{
  &quot;Version&quot;: &quot;2012-10-17&quot;,
  &quot;Statement&quot;: [
    {
      ...
    }
  ]
}
EOF
</code></pre>

<p>Modifying the <code>bbl.tfvars</code> file directly can change the variables used in the base Terraform template; however, this is not recommended since these variables are
generated by <code>bbl</code> from credentials and other user-provided settings and may be overwritten by subsequent <code>bbl</code> runs. Instead, you should alter the input to <code>bbl plan</code>.</p>
<p><code>bbl</code> provides several files within the <code>vars</code> directory, and will edit them on subsequent runs. These files include:
- <code>bbl.tfvars</code> - used by <code>bbl</code> to provide credentials and other user-provided settings to Terraform
- <code>bosh-state.json</code> - used by the BOSH CLI to store state for the BOSH director deployment
- <code>cloud-config-vars.yml</code> - used by <code>bbl</code> to provide Terraform outputs to the BOSH cloud-config
- <code>director-vars-file.yml</code> - used by <code>bbl</code> to provide Terraform outputs to the BOSH create-env call for the director
- <code>director-vars-store.yml</code> - used by the BOSH CLI to store generated variables for the BOSH director deployment
- <code>jumpbox-state.json</code> - used by the BOSH CLI to store state for the jumpbox deployment
- <code>jumpbox-vars-file.yml</code> - used by <code>bbl</code> to provide Terraform outputs to the BOSH create-env call for the jumpbox
- <code>jumpbox-vars-store.yml</code> - used by the BOSH CLI to store generated variables for the BOSH jumpbox deployment
- <code>terraform.tfstate</code> and <code>terraform.tfstate.backup</code> - used by the Terraform CLI to store state</p>
<p>These files should not be edited by the user. All other files placed in the <code>vars</code> directory are safe and will not be modified by <code>bbl</code>.</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../credhub/" title="Accessing the BOSH Director CredHub" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Accessing the BOSH Director CredHub
              </span>
            </div>
          </a>
        
        
          <a href="../getting-started-aws/" title="Getting Started: AWS" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Getting Started: AWS
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.d9aa80ab.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
  </body>
</html>